---
title: "Task3"
output: html_document
date: "2022-11-11"
---

## Предварительный анализ данных.
Прочитаем и обработаем данные. Среди данных не может быть отрицательных значений, 
NA обозначаются как -999.
```{r, message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(tidyr)
```

```{r, message=FALSE, warning=FALSE}
df <- read_excel("Sleep/SLEEP_shortname.xls")
df[df < 0] <- NA

head(df)
length(df$NAME)
```
Кроме индексов-факторов, все признаки количественные. Индексы - порядковые признаки.

Посмотрим на данные.
```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(GGally)
```

```{r, message=FALSE, warning=FALSE}
df %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), 
          columns = c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```
Преобразуем данные. Переведем вес животного в граммы, продолжительность жизни в
дни. Логарифмируем данные, чтобы было легче наблюдать корреляции (выше заметны 
сильно отличающиеся индивиды, это слоны). Факторизуем индексы.
```{r}
dfNew <- df %>% mutate(PRED_IND = as.factor(PRED_IND), EXP_IND = as.factor(EXP_IND),
                   DANG_IND = as.factor(DANG_IND), 
                   BODY_WEI = log(BODY_WEI * 1000), BRAIN_WE = log(BRAIN_WE), 
                   LIFESPAN = log(LIFESPAN * 365.25), GESTTIME = log(GESTTIME))
```
Посмотрим на новые данные. Сгруппируем индивидов по факторам. 
```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), 
          columns = c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=PRED_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=EXP_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=DANG_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```
Используем описательные статистики для распределений признаков в изначальной 
и новой выборках.
```{r}
library(moments)
library(entropy)
```
Вес тела.
```{r}
cat("df:\n")
mean(df$BODY_WEI, na.rm = TRUE)
quantile(df$BODY_WEI, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(df$BODY_WEI, na.rm = TRUE)
skewness(df$BODY_WEI, na.rm = TRUE)

cat("\ndfNew:\n")
mean(dfNew$BODY_WEI, na.rm = TRUE)
quantile(dfNew$BODY_WEI, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(dfNew$BODY_WEI, na.rm = TRUE)
skewness(dfNew$BODY_WEI, na.rm = TRUE)
kurtosis(dfNew$BODY_WEI, na.rm = TRUE)
```
Вес мозга.
```{r}
cat("df:\n")
mean(df$BRAIN_WE, na.rm = TRUE)
quantile(df$BRAIN_WE, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(df$BRAIN_WE, na.rm = TRUE)
skewness(df$BRAIN_WE, na.rm = TRUE)

cat("\ndfNew:\n")
mean(dfNew$BRAIN_WE, na.rm = TRUE)
quantile(dfNew$BRAIN_WE, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(dfNew$BRAIN_WE, na.rm = TRUE)
skewness(dfNew$BRAIN_WE, na.rm = TRUE)
kurtosis(dfNew$BRAIN_WE, na.rm = TRUE)
```
Медленный сон.
```{r}
cat("df:\n")
mean(df$SLOWWAVE, na.rm = TRUE)
quantile(df$SLOWWAVE, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(df$SLOWWAVE, na.rm = TRUE)
skewness(df$SLOWWAVE, na.rm = TRUE)
kurtosis(dfNew$SLOWWAVE, na.rm = TRUE)
```
Быстрый сон.
```{r}
cat("df:\n")
mean(df$PARADOX, na.rm = TRUE)
quantile(df$PARADOX, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(df$PARADOX, na.rm = TRUE)
skewness(df$PARADOX, na.rm = TRUE)
kurtosis(dfNew$PARADOX, na.rm = TRUE)
```
Cон.
```{r}
cat("df:\n")
mean(df$SLEEP, na.rm = TRUE)
quantile(df$SLEEP, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(df$SLEEP, na.rm = TRUE)
skewness(df$SLEEP, na.rm = TRUE)
kurtosis(dfNew$SLEEP, na.rm = TRUE)
```
Продолжительность жизни.
```{r}
cat("df:\n")
mean(df$LIFESPAN, na.rm = TRUE)
quantile(df$LIFESPAN, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(df$LIFESPAN, na.rm = TRUE)
skewness(df$LIFESPAN, na.rm = TRUE)

cat("\ndfNew:\n")
mean(dfNew$LIFESPAN, na.rm = TRUE)
quantile(dfNew$LIFESPAN, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(dfNew$LIFESPAN, na.rm = TRUE)
skewness(dfNew$LIFESPAN, na.rm = TRUE)
kurtosis(dfNew$LIFESPAN, na.rm = TRUE)
```
Продолжительность периода вынашивания потомства.
```{r}
cat("df:\n")
mean(df$GESTTIME, na.rm = TRUE)
quantile(df$GESTTIME, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(df$GESTTIME, na.rm = TRUE)
skewness(df$GESTTIME, na.rm = TRUE)

cat("\ndfNew:\n")
mean(dfNew$GESTTIME, na.rm = TRUE)
quantile(dfNew$GESTTIME, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
var(dfNew$GESTTIME, na.rm = TRUE)
skewness(dfNew$GESTTIME, na.rm = TRUE)
kurtosis(dfNew$GESTTIME, na.rm = TRUE)
```
Идекс, отражающий опасность стать добычей.
```{r}
quantile(df$PRED_IND, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
entropy.empirical(df$PRED_IND, unit="log2")
```
Идекс, отражающий безопасность места, где спит животное.
```{r}
quantile(df$EXP_IND, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
entropy.empirical(df$EXP_IND, unit="log2")
```
Идекс, отражающий опасность, в которой находиться животное.
```{r}
quantile(df$DANG_IND, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
entropy.empirical(df$DANG_IND, unit="log2")
```

## О виде распределений и о сравнении распределений.
### Индивидуальное задание 2.
Опишем распределения признаков.
```{r, warning=FALSE, message = FALSE}
library(reshape)
```
Изобразим гистограммы признаков на фоне плотности нормального распределения.
```{r, warning=FALSE, message = FALSE}
dfMelt <- dfNew %>% 
  dplyr::select(-PRED_IND, -DANG_IND) %>% 
  as.data.frame(dfNew) %>% 
  melt(id.vars = c("NAME", "EXP_IND"))

ggplot(dfMelt, aes(x = value)) +
        geom_histogram(aes(y = ..density..)) +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        geom_line(aes(y = dnorm(value,
                      mean = tapply(value, variable, mean, na.rm = TRUE)[PANEL],
                      sd = tapply(value, variable, sd, na.rm = TRUE)[PANEL]
                      )), color = "blue")
```
Изобразим выборочную функцию распредления признаков на фоне функции 
распределения нормального распределения.
```{r, warning=FALSE, message = FALSE}
ggplot(dfMelt, aes(x = value)) +
        stat_ecdf() +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        geom_line(aes(y = pnorm(value,
                      mean = tapply(value, variable, mean, na.rm = TRUE)[PANEL],
                      sd = tapply(value, variable, sd, na.rm = TRUE)[PANEL]
                      )), color = "blue")
```
Можно заметить, что имеет место нормальность распределения признаков. Давайте 
еще нарисуем PP-plot и QQ-plot.
```{r, warning=FALSE, message = FALSE}
library(qqplotr) 
```

```{r, warning=FALSE, message = FALSE}
ggplot(dfMelt, aes(sample = value)) +
        stat_pp_point(size = 1) +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        stat_pp_line(color = "blue")
```

```{r, warning=FALSE, message = FALSE}
ggplot(dfMelt, aes(sample = value)) +
        stat_qq_point(size = 1) +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        stat_qq_line(color = "blue")
```
Проверим нормальность с помощью признаков.

Используем критерий Колмогорова-Смирнова, так как распределения абсолютно 
непрерывны.
```{r, warning=FALSE, message = FALSE}
ks.test(dfNew$BODY_WEI, "pnorm", mean = mean(dfNew$BODY_WEI, na.rm=TRUE), sd = sd(dfNew$BODY_WEI, na.rm=TRUE))
ks.test(dfNew$BRAIN_WE, "pnorm", mean = mean(dfNew$BRAIN_WE, na.rm=TRUE), sd = sd(dfNew$BRAIN_WE, na.rm=TRUE))
ks.test(dfNew$SLOWWAVE, "pnorm", mean = mean(dfNew$SLOWWAVE, na.rm=TRUE), sd = sd(dfNew$SLOWWAVE, na.rm=TRUE))
ks.test(dfNew$PARADOX, "pnorm", mean = mean(dfNew$PARADOX, na.rm=TRUE), sd = sd(dfNew$PARADOX, na.rm=TRUE))
ks.test(dfNew$SLEEP, "pnorm", mean = mean(dfNew$SLEEP, na.rm=TRUE), sd = sd(dfNew$SLEEP, na.rm=TRUE))
ks.test(dfNew$LIFESPAN, "pnorm", mean = mean(dfNew$LIFESPAN, na.rm=TRUE), sd = sd(dfNew$LIFESPAN, na.rm=TRUE))
ks.test(dfNew$GESTTIME, "pnorm", mean = mean(dfNew$GESTTIME, na.rm=TRUE), sd = sd(dfNew$GESTTIME, na.rm=TRUE))
```
Все тесты не отрицают, что признаки имеют нормальное распределение с уровнем 
значимости 0.5.


--------------------------------------------------------------------
### Индивидуальное задание 1. 
Опишем разницу между животными по степени опасности места, где они спят.
```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=BODY_WEI, colour=EXP_IND)) + geom_boxplot()
dfNew %>% ggplot(aes(y=BRAIN_WE, colour=EXP_IND)) + geom_boxplot()
dfNew %>% ggplot(aes(y=SLOWWAVE, colour=EXP_IND)) + geom_boxplot()
dfNew %>% ggplot(aes(y=PARADOX, colour=EXP_IND)) + geom_boxplot()
dfNew %>% ggplot(aes(y=SLEEP, colour=EXP_IND)) + geom_boxplot()
dfNew %>% ggplot(aes(y=LIFESPAN, colour=EXP_IND)) + geom_boxplot()
dfNew %>% ggplot(aes(y=GESTTIME, colour=EXP_IND)) + geom_boxplot()
```
Можно заметить, что животные живущие в более защищенных местах 1,2) имеют меньший
вес тела и мозга; 3,4,5) чаще дольше спят в общем и в разных фазах сна по отдельности;
6,7) имеют менее длительные продолжительность жизни и период вынашивания потомства. 
Проверим это с помощью критериев.

Давайте проверим наблюдения 1,3,6) c помощью критериев для животных, живущих
в ниболее и в наименее защищенных местах.
```{r}
dfNew1 <- dplyr::filter(dfNew, EXP_IND == 1)
dfNew5 <- dplyr::filter(dfNew, EXP_IND == 5)

length(dfNew1$NAME)
length(dfNew5$NAME)
```
Ранее мы узнали, что признаки распределены нормально, но сейчас мы будем сравнивать
разные группы индивидов, признаки внутри которых могут уже не имеют нормальность,
ограничимся здесь визуальным подверждением утверждения.
Отсутствие нормальности можно было наблюдать на окрашенном ggpairs, но лучше
это демонстрирует следующий график.
```{r, warning=FALSE, message = FALSE}
ggplot(dfMelt, aes(x = value, colour=EXP_IND)) +
        stat_ecdf() +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        geom_line(aes(y = pnorm(value,
                      mean = tapply(value, variable, mean, na.rm = TRUE)[PANEL],
                      sd = tapply(value, variable, sd, na.rm = TRUE)[PANEL]
                      )), color = "blue")
```
Группы у нас независимые и не имеют нормальное распределение. Поэтому будем использовать критерии для независимых с.в.
```{r}
t.test(dfNew1$BODY_WEI, dfNew2$BODY_WEI, alternative="less")
t.test(dfNew1$BODY_WEI, dfNew3$BODY_WEI, alternative="less")
t.test(dfNew1$BODY_WEI, dfNew4$BODY_WEI, alternative="less")
t.test(dfNew1$BODY_WEI, dfNew5$BODY_WEI, alternative="less")

t.test(dfNew2$BODY_WEI, dfNew3$BODY_WEI, alternative="less")
t.test(dfNew2$BODY_WEI, dfNew4$BODY_WEI, alternative="less")
t.test(dfNew2$BODY_WEI, dfNew5$BODY_WEI, alternative="less")

t.test(dfNew3$BODY_WEI, dfNew4$BODY_WEI, alternative="less")
t.test(dfNew3$BODY_WEI, dfNew5$BODY_WEI, alternative="less")

t.test(dfNew4$BODY_WEI, dfNew5$BODY_WEI, alternative="less")
```
Потчти все гипотезы о равенстве мат. ожиданий отверглись в пользу того, что
животное, которое спит в более защищенном месте весит меньше, с уровнем 
значимости 0.05.
```{r}
t.test(dfNew1$BRAIN_WE, dfNew2$BRAIN_WE, alternative="less")
t.test(dfNew1$BRAIN_WE, dfNew3$BRAIN_WE, alternative="less")
t.test(dfNew1$BRAIN_WE, dfNew4$BRAIN_WE, alternative="less")
t.test(dfNew1$BRAIN_WE, dfNew5$BRAIN_WE, alternative="less")

t.test(dfNew2$BRAIN_WE, dfNew3$BRAIN_WE, alternative="less")
t.test(dfNew2$BRAIN_WE, dfNew4$BRAIN_WE, alternative="less")
t.test(dfNew2$BRAIN_WE, dfNew5$BRAIN_WE, alternative="less")

t.test(dfNew3$BRAIN_WE, dfNew4$BRAIN_WE, alternative="less")
t.test(dfNew3$BRAIN_WE, dfNew5$BRAIN_WE, alternative="less")

t.test(dfNew4$BRAIN_WE, dfNew5$BRAIN_WE, alternative="less")
```
Если не учитывать животных, близких друг другу по значению EXP_IND, то потчти 
все гипотезы о равенстве мат. ожиданий отверглись в пользу того, что животное, 
которое спит в более защищенном месте имеет меньший вес мозга, с уровнем 
значимости 0.05.
```{r}
t.test(dfNew1$SLOWWAVE, dfNew2$SLOWWAVE, alternative="greater")
t.test(dfNew1$SLOWWAVE, dfNew3$SLOWWAVE, alternative="greater")
t.test(dfNew1$SLOWWAVE, dfNew4$SLOWWAVE, alternative="greater")
t.test(dfNew1$SLOWWAVE, dfNew5$SLOWWAVE, alternative="greater")

t.test(dfNew2$SLOWWAVE, dfNew3$SLOWWAVE, alternative="greater")
t.test(dfNew2$SLOWWAVE, dfNew4$SLOWWAVE, alternative="greater")
t.test(dfNew2$SLOWWAVE, dfNew5$SLOWWAVE, alternative="greater")

t.test(dfNew3$SLOWWAVE, dfNew4$SLOWWAVE, alternative="greater")
t.test(dfNew3$SLOWWAVE, dfNew5$SLOWWAVE, alternative="greater")

t.test(dfNew4$SLOWWAVE, dfNew5$SLOWWAVE, alternative="greater")
```
Тесты подтверждают результаты, наблюдаемые на box-plot-ах. 
```{r}
t.test(dfNew1$PARADOX, dfNew2$PARADOX, alternative="greater")
t.test(dfNew1$PARADOX, dfNew3$PARADOX, alternative="greater")
t.test(dfNew1$PARADOX, dfNew4$PARADOX, alternative="greater")
t.test(dfNew1$PARADOX, dfNew5$PARADOX, alternative="greater")

t.test(dfNew2$PARADOX, dfNew3$PARADOX, alternative="greater")
t.test(dfNew2$PARADOX, dfNew4$PARADOX, alternative="greater")
t.test(dfNew2$PARADOX, dfNew5$PARADOX, alternative="greater")

t.test(dfNew3$PARADOX, dfNew4$PARADOX, alternative="greater")
t.test(dfNew3$PARADOX, dfNew5$PARADOX, alternative="greater")

t.test(dfNew4$PARADOX, dfNew5$PARADOX, alternative="greater")
```
Тесты подтверждают результаты, наблюдаемые на box-plot-ах. 
```{r}
t.test(dfNew1$SLEEP, dfNew2$SLEEP, alternative="greater")
t.test(dfNew1$SLEEP, dfNew3$SLEEP, alternative="greater")
t.test(dfNew1$SLEEP, dfNew4$SLEEP, alternative="greater")
t.test(dfNew1$SLEEP, dfNew5$SLEEP, alternative="greater")

t.test(dfNew2$SLEEP, dfNew3$SLEEP, alternative="greater")
t.test(dfNew2$SLEEP, dfNew4$SLEEP, alternative="greater")
t.test(dfNew2$SLEEP, dfNew5$SLEEP, alternative="greater")

t.test(dfNew3$SLEEP, dfNew4$SLEEP, alternative="greater")
t.test(dfNew3$SLEEP, dfNew5$SLEEP, alternative="greater")

t.test(dfNew4$SLEEP, dfNew5$SLEEP, alternative="greater")
```
Тесты подтверждают результаты, наблюдаемые на box-plot-ах. 
```{r}
t.test(dfNew1$LIFESPAN, dfNew2$LIFESPAN, alternative="less")
t.test(dfNew1$LIFESPAN, dfNew3$LIFESPAN, alternative="less")
t.test(dfNew1$LIFESPAN, dfNew4$LIFESPAN, alternative="less")
t.test(dfNew1$LIFESPAN, dfNew5$LIFESPAN, alternative="less")

t.test(dfNew2$LIFESPAN, dfNew3$LIFESPAN, alternative="less")
t.test(dfNew2$LIFESPAN, dfNew4$LIFESPAN, alternative="less")
t.test(dfNew2$LIFESPAN, dfNew5$LIFESPAN, alternative="less")

t.test(dfNew3$LIFESPAN, dfNew4$LIFESPAN, alternative="less")
t.test(dfNew3$LIFESPAN, dfNew5$LIFESPAN, alternative="less")

t.test(dfNew4$LIFESPAN, dfNew5$LIFESPAN, alternative="less")
```
Тесты подтверждают результаты, наблюдаемые на box-plot-ах. 
```{r}
t.test(dfNew1$GESTTIME, dfNew2$GESTTIME, alternative="less")
t.test(dfNew1$GESTTIME, dfNew3$GESTTIME, alternative="less")
t.test(dfNew1$GESTTIME, dfNew4$GESTTIME, alternative="less")
t.test(dfNew1$GESTTIME, dfNew5$GESTTIME, alternative="less")

t.test(dfNew2$GESTTIME, dfNew3$GESTTIME, alternative="less")
t.test(dfNew2$GESTTIME, dfNew4$GESTTIME, alternative="less")
t.test(dfNew2$GESTTIME, dfNew5$GESTTIME, alternative="less")

t.test(dfNew3$GESTTIME, dfNew4$GESTTIME, alternative="less")
t.test(dfNew3$GESTTIME, dfNew5$GESTTIME, alternative="less")

t.test(dfNew4$GESTTIME, dfNew5$GESTTIME, alternative="less")
```
Тесты подтверждают результаты, наблюдаемые на box-plot-ах. 
-------------------------------------------------------
## Дальше смотреть не надо.
Посмотрим на корреляции между признаками.
```{r, warning=FALSE, message = FALSE}
dplyr::select(dfNew, -NAME) %>%
mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
cor(method = "pearson", use = "pairwise.complete.obs") %>%
melt() %>%
ggplot(aes(X1, X2)) +
  geom_raster(aes(fill = value)) +
  geom_text(aes(label = round(value, 3))) +
  scale_fill_gradient2(low=colors()[555], mid=colors()[1], high=colors()[26]) + 
  ggtitle("dfNew pearson") +
  theme(axis.text.x = element_text(angle = 50, hjust = 1))

dplyr::select(dfNew, -NAME) %>%
mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
cor(method = "spearman", use = "pairwise.complete.obs") %>%
melt() %>%
ggplot(aes(X1, X2)) +
  geom_raster(aes(fill = value)) +
  geom_text(aes(label = round(value, 3))) +
  scale_fill_gradient2(low=colors()[555], mid=colors()[1], high=colors()[26]) + 
  ggtitle("dfNew spearman") +
  theme(axis.text.x = element_text(angle = 50, hjust = 1))
```

В качестве описания зависимостей между критериями выше представленны ggpairs и
correlation matrix plot. Также посчитаем интересные частные корреляции.
```{r, warning=FALSE, message = FALSE}
library(ppcor)
```
Посмотрим на частную корреляцию веса животного и сна за вычетом идексов опасности.
```{r, warning=FALSE, message = FALSE}
((dplyr::select(dfNew, -NAME, -BRAIN_WE, -LIFESPAN, -GESTTIME, -SLOWWAVE, -PARADOX) %>%
  mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>%
as.data.frame())["SLEEP", "BODY_WEI"]

((dplyr::select(dfNew, -NAME, -BRAIN_WE, -LIFESPAN, -GESTTIME, -SLEEP, -PARADOX) %>%
  mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>%
as.data.frame())["SLOWWAVE", "BODY_WEI"]

((dplyr::select(dfNew, -NAME, -BRAIN_WE, -LIFESPAN, -GESTTIME, -SLOWWAVE, -SLEEP) %>%
  mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>%
as.data.frame())["PARADOX", "BODY_WEI"]
```
Посмотрим на частые корреляции индексов опасности животного и сна за вычетом 
веса и связанных с ним критериев.
```{r, warning=FALSE, message = FALSE}
((dplyr::select(dfNew, -NAME, -EXP_IND, -DANG_IND, -SLOWWAVE, -PARADOX) %>%
  mutate(PRED_IND = as.numeric(PRED_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["SLEEP", "PRED_IND"]

((dplyr::select(dfNew, -NAME, -EXP_IND, -DANG_IND, -SLEEP, -PARADOX) %>%
  mutate(PRED_IND = as.numeric(PRED_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["SLOWWAVE", "PRED_IND"]

((dplyr::select(dfNew, -NAME, -EXP_IND, -DANG_IND, -SLOWWAVE, -SLEEP) %>%
  mutate(PRED_IND = as.numeric(PRED_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["PARADOX", "PRED_IND"]
```

```{r, warning=FALSE, message = FALSE}
((dplyr::select(dfNew, -NAME, -PRED_IND, -DANG_IND, -SLOWWAVE, -PARADOX) %>%
  mutate(EXP_IND = as.numeric(EXP_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["SLEEP", "EXP_IND"]

((dplyr::select(dfNew, -NAME, -PRED_IND, -DANG_IND, -SLEEP, -PARADOX) %>%
  mutate(EXP_IND = as.numeric(EXP_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["SLOWWAVE", "EXP_IND"]

((dplyr::select(dfNew, -NAME, -PRED_IND, -DANG_IND, -SLOWWAVE, -SLEEP) %>%
  mutate(EXP_IND = as.numeric(EXP_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["PARADOX", "EXP_IND"]
```

```{r, warning=FALSE, message = FALSE}
((dplyr::select(dfNew, -NAME, -PRED_IND, -EXP_IND, -SLOWWAVE, -PARADOX) %>%
  mutate(DANG_IND = as.numeric(DANG_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["SLEEP", "DANG_IND"]

((dplyr::select(dfNew, -NAME, -PRED_IND, -EXP_IND, -SLEEP, -PARADOX) %>%
  mutate(DANG_IND = as.numeric(DANG_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["SLOWWAVE", "DANG_IND"]

((dplyr::select(dfNew, -NAME, -PRED_IND, -EXP_IND, -SLOWWAVE, -SLEEP) %>%
  mutate(DANG_IND = as.numeric(DANG_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["PARADOX", "DANG_IND"]
```




