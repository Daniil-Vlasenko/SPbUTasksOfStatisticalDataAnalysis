---
title: "Task3"
output: 
  html_document:
    toc: true
    toc_float: true
date: "2022-11-11"
---

# Предварительный анализ данных. 
1\. Описание признаков присутствует в сопроводительном файле. Прочитаем данные. 
Среди данных не может быть отрицательных значений, NA обозначаются как -999.
```{r, message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(tidyr)
```

```{r, message=FALSE, warning=FALSE}
df <- read_excel("Sleep/SLEEP_shortname.xls")
df[df < 0] <- NA

head(df)
```

Количество строк в таблице.
```{r}
nrow(df)
```

2\. Признаков немного, поэтому рассматривать будем все.

3\. Кроме индексов-факторов, все признаки количественные. Индексы - порядковые признаки.
Все количественные признаки непрерывные, но можно заметить дискретизацию при округлении.
Проверим это, посмотрев на частоты мод и повторов.
```{r}
mode_rate <- function(x) {
  x <- x[!is.na(x)]
  u <- unique(x)
  tab <- tabulate(match(x, u))
  max(tab) / length(x)
}

repeat_rate <- function(x) {
  x <- x[!is.na(x)]
  u <- unique(x)
  (length(x) - length(u)) / length(x)
}
```

```{r}
cat("Отношение частоты моды к числу элементов для BODY_WEI:", mode_rate(df$BODY_WEI), 
    "\nОтношение частоты повторных элементов к числу элементов для BODY_WEI:", repeat_rate(df$BODY_WEI))
cat("Отношение частоты моды к числу элементов для BRAIN_WE:", mode_rate(df$BRAIN_WE), 
    "\nОтношение частоты повторных элементов к числу элементов для BRAIN_WE:", repeat_rate(df$BRAIN_WE))
cat("Отношение частоты моды к числу элементов для SLOWWAVE:", mode_rate(df$SLOWWAVE), 
    "\nОтношение частоты повторных элементов к числу элементов для SLOWWAVE:", repeat_rate(df$SLOWWAVE))
cat("Отношение частоты моды к числу элементов для PARADOX:", mode_rate(df$PARADOX), 
    "\nОтношение частоты повторных элементов к числу элементов для PARADOX:", repeat_rate(df$PARADOX))
cat("Отношение частоты моды к числу элементов для SLEEP:", mode_rate(df$SLEEP), 
    "\nОтношение частоты повторных элементов к числу элементов для SLEEP:", repeat_rate(df$SLEEP))
cat("Отношение частоты моды к числу элементов для LIFESPAN:", mode_rate(df$LIFESPAN), 
    "\nОтношение частоты повторных элементов к числу элементов  для LIFESPAN:", repeat_rate(df$LIFESPAN))
cat("Отношение частоты моды к числу элементов для GESTTIME:", mode_rate(df$GESTTIME), 
    "\nОтношение частоты повторных элементов к числу элементов для GESTTIME:", repeat_rate(df$GESTTIME))
```

Будем считать данные дискретными если отношение частоты моды к числу элементов 
больше 10%, а отношение частоты повторных элементов к числу элементов больше 15%.
Тогда BODY_WEI, BRAIN_WE будут непрерывными, а BRAIN_WE, PARADOX, SLEEP, LIFESPAN, 
GESTTIME дискретными.

4\. Не актуально для текущих данных.

5\. Посмотрим на данные.
```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(GGally)
```

```{r, message=FALSE, warning=FALSE}
df %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), 
          columns = c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

6\. Преобразуем данные. Переведем вес животного в граммы, продолжительность жизни в
дни. Логарифмируем данные, чтобы было легче наблюдать корреляции (выше заметны 
сильно отличающиеся индивиды, это слоны). Факторизуем индексы.
```{r}
dfNew <- df %>% mutate(PRED_IND = as.factor(PRED_IND), EXP_IND = as.factor(EXP_IND),
                   DANG_IND = as.factor(DANG_IND), 
                   BODY_WEI = log(BODY_WEI * 1000), BRAIN_WE = log(BRAIN_WE), 
                   LIFESPAN = log(LIFESPAN * 365.25), GESTTIME = log(GESTTIME))
```

Посмотрим на новые данные. Сгруппируем индивидов по факторам.

## {.tabset .unlisted .unnumbered}

### No factorization

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), 
          columns = c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

### PRED_IND

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=PRED_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

### EXP_IND

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=EXP_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

### DANG_IND

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=DANG_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

## {.unlisted .unnumbered}

7\. Аутлайнеров нет.

8\. Неоднородности нет.

9\. Не актуально для текущих данных.

10\. Используем описательные статистики для распределений признаков в новой выборке.
```{r}
library(moments)
```

```{r}
info <- function(x) {
  c(mean(x, na.rm = TRUE), 
    median(x, na.rm = TRUE),
    var(x, na.rm = TRUE),
    skewness(x, na.rm = TRUE),
    kurtosis(x, na.rm = TRUE))
}
```

Вес тела.
```{r}
x <- info(dfNew$BODY_WEI)
cat("Среднее:", x[1], "\nВыб. медиана:", x[2], "\nВыб. дисперсия:", x[3], 
    "\nВыб. коэфф. ассиментрии:", x[4], "\nВыб. коэфф. эксцесса:", x[5])
```

Вес мозга.
```{r}
x <- info(dfNew$BRAIN_WE)
cat("Среднее:", x[1], "\nВыб. медиана:", x[2], "\nВыб. дисперсия:", x[3], 
    "\nВыб. коэфф. ассиментрии:", x[4], "\nВыб. коэфф. эксцесса:", x[5])
```

Медленный сон.
```{r}
x <- info(dfNew$SLOWWAVE)
cat("Среднее:", x[1], "\nВыб. медиана:", x[2], "\nВыб. дисперсия:", x[3], 
    "\nВыб. коэфф. ассиментрии:", x[4], "\nВыб. коэфф. эксцесса:", x[5])
```

Быстрый сон.
```{r}
x <- info(dfNew$PARADOX)
cat("Среднее:", x[1], "\nВыб. медиана:", x[2], "\nВыб. дисперсия:", x[3], 
    "\nВыб. коэфф. ассиментрии:", x[4], "\nВыб. коэфф. эксцесса:", x[5])
```

Cон.
```{r}
x <- info(dfNew$SLEEP)
cat("Среднее:", x[1], "\nВыб. медиана:", x[2], "\nВыб. дисперсия:", x[3], 
    "\nВыб. коэфф. ассиментрии:", x[4], "\nВыб. коэфф. эксцесса:", x[5])
```

Продолжительность жизни.
```{r}
x <- info(dfNew$LIFESPAN)
cat("Среднее:", x[1], "\nВыб. медиана:", x[2], "\nВыб. дисперсия:", x[3], 
    "\nВыб. коэфф. ассиментрии:", x[4], "\nВыб. коэфф. эксцесса:", x[5])
```

Продолжительность периода вынашивания потомства.
```{r}
x <- info(dfNew$GESTTIME)
cat("Среднее:", x[1], "\nВыб. медиана:", x[2], "\nВыб. дисперсия:", x[3], 
    "\nВыб. коэфф. ассиментрии:", x[4], "\nВыб. коэфф. эксцесса:", x[5])
```

# О виде распределений и о сравнении распределений.
## Индивидуальное задание 2.
1\. Проверим распределения признаков на нормальность.
```{r, warning=FALSE, message = FALSE}
library(reshape)
```

Изобразим гистограммы признаков на фоне плотности нормального распределения.
```{r, warning=FALSE, message = FALSE}
dfMelt <- dfNew %>% 
  dplyr::select(-PRED_IND, -DANG_IND) %>% 
  as.data.frame(dfNew) %>% 
  melt(id.vars = c("NAME", "EXP_IND"))

ggplot(dfMelt, aes(x = value)) +
        geom_histogram(aes(y = ..density..)) +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        geom_line(aes(y = dnorm(value,
                      mean = tapply(value, variable, mean, na.rm = TRUE)[PANEL],
                      sd = tapply(value, variable, sd, na.rm = TRUE)[PANEL]
                      )), color = "blue")
```

Изобразим выборочную функцию распредления признаков на фоне функции 
распределения нормального распределения.
```{r, warning=FALSE, message = FALSE}
ggplot(dfMelt, aes(x = value)) +
        stat_ecdf() +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        geom_line(aes(y = pnorm(value,
                      mean = tapply(value, variable, mean, na.rm = TRUE)[PANEL],
                      sd = tapply(value, variable, sd, na.rm = TRUE)[PANEL]
                      )), color = "blue")
```

Давайте еще нарисуем PP-plot и QQ-plot.
```{r, warning=FALSE, message = FALSE}
library(qqplotr) 
```

```{r, warning=FALSE, message = FALSE}
ggplot(dfMelt, aes(sample = value)) +
        stat_pp_point(size = 1) +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        stat_pp_line(color = "blue")
```

```{r, warning=FALSE, message = FALSE}
ggplot(dfMelt, aes(sample = value)) +
        stat_qq_point(size = 1) +
        facet_wrap(~variable, scales = "free") +
        labs(x = "", y = "") +
        stat_qq_line(color = "blue")
```

2\. Похоже, что нормальность имеет место. Проверим это с помощью критериев.
```{r}
library(nortest)
```

У нас достаточно повторений в некоторых выборках, чтобы не использовать критерий 
Пирсона, но все ранво проведем его, скорее, ради академического интереса.
Критерий Лиллиефорса - это модификация критерия Колмогорова-Смирнова для проверки
сложных гипотез нормальности данных.
Критерий Андерона-Дарлинга - это один из критериев типа w^2.
Критерий Шапира-Уилка - примерно квадрат корреляции между x и y в n.p.p.

Вес тела.
```{r}
pearson.test(dfNew$BODY_WEI)
lillie.test(dfNew$BODY_WEI)
ad.test(dfNew$BODY_WEI)
shapiro.test(dfNew$BODY_WEI)
```

Вес мозга.
```{r}
pearson.test(dfNew$BRAIN_WE)
lillie.test(dfNew$BRAIN_WE)
ad.test(dfNew$BRAIN_WE)
shapiro.test(dfNew$BRAIN_WE)
```

Медленный сон.
```{r}
pearson.test(dfNew$SLOWWAVE)
lillie.test(dfNew$SLOWWAVE)
ad.test(dfNew$SLOWWAVE)
shapiro.test(dfNew$SLOWWAVE)
```

Быстрый сон.
```{r}
pearson.test(dfNew$PARADOX)
lillie.test(dfNew$PARADOX)
ad.test(dfNew$PARADOX)
shapiro.test(dfNew$PARADOX)
```

Сон.
```{r}
pearson.test(dfNew$SLEEP)
lillie.test(dfNew$SLEEP)
ad.test(dfNew$SLEEP)
shapiro.test(dfNew$SLEEP)
```

Продолжительность жизни.
```{r}
pearson.test(dfNew$LIFESPAN)
lillie.test(dfNew$LIFESPAN)
ad.test(dfNew$LIFESPAN)
shapiro.test(dfNew$LIFESPAN)
```

Продолжительность периода вынашивания потомства.
```{r}
pearson.test(dfNew$GESTTIME)
lillie.test(dfNew$GESTTIME)
ad.test(dfNew$GESTTIME)
shapiro.test(dfNew$GESTTIME)
```

Гипотеза о нормальности распределения для быстрого сна отвергается многими 
критериями с уровнем значисости 0.05. Гипотеза нормльности распределения для 
веса животного отвергается критерием Лиллиефорса с уровнем значисости 0.05. 
Остальные критерии гипотезы не отвергли с уровнем значисости 0.05.

## Индивидуальное задание 1. 
3\. Опишем разницу между животными по степени опасности места, где они спят.

## {.tabset .unlisted .unnumbered}

### BODY_WEI

```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=BODY_WEI, colour=EXP_IND)) + geom_boxplot()
```

### BRAIN_WE

```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=BRAIN_WE, colour=EXP_IND)) + geom_boxplot()
```

### SLOWWAVE

```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=SLOWWAVE, colour=EXP_IND)) + geom_boxplot()
```

### PARADOX

```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=PARADOX, colour=EXP_IND)) + geom_boxplot()
```

### SLEEP

```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=SLEEP, colour=EXP_IND)) + geom_boxplot()
```

### LIFESPAN

```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=LIFESPAN, colour=EXP_IND)) + geom_boxplot()
```

### GESTTIME

```{r, warning=FALSE, message = FALSE}
dfNew %>% ggplot(aes(y=GESTTIME, colour=EXP_IND)) + geom_boxplot()
```

## {.unlisted .unnumbered}

Можно заметить, что животные, живущие в более защищенных местах, 1,2) имеют меньший
вес тела и мозга; 3,4,5) чаще дольше спят в общем и в разных фазах сна по отдельности;
6,7) имеют менее длительные продолжительность жизни и период вынашивания потомства. 

Давайте проверим наблюдения 1,3) c помощью критериев для животных, живущих
в ниболее и в наименее защищенных местах.
```{r}
dfNew1 <- dplyr::filter(dfNew, EXP_IND == 1)
dfNew5 <- dplyr::filter(dfNew, EXP_IND == 5)

nrow(dfNew1)
nrow(dfNew5)
```

Ранее мы узнали, что многие признаки распределены нормально, но сейчас мы будем 
сравнивать разные группы индивидов, признаки внутри которых могут уже не имеют 
нормальность. Проверим это графически и критериями
```{r, warning=FALSE, message = FALSE}
ggplot(dfNew1, aes(sample = BODY_WEI)) +
        stat_qq_point(size = 1) +
        labs(x = "", y = "") +
        stat_qq_line(color = "blue")
ggplot(dfNew1, aes(sample = SLEEP)) +
        stat_qq_point(size = 1) +
        labs(x = "", y = "") +
        stat_qq_line(color = "blue")

ggplot(dfNew5, aes(sample = BODY_WEI)) +
        stat_qq_point(size = 1) +
        labs(x = "", y = "") +
        stat_qq_line(color = "blue")
ggplot(dfNew5, aes(sample = SLEEP)) +
        stat_qq_point(size = 1) +
        labs(x = "", y = "") +
        stat_qq_line(color = "blue")
```

Используем те же критерии, что использовали ранее.

Вес тела для животных, спящих в более защищенном месте.
```{r}
pearson.test(dfNew1$BODY_WEI)
lillie.test(dfNew1$BODY_WEI)
ad.test(dfNew1$BODY_WEI)
shapiro.test(dfNew1$BODY_WEI)
```

Сон для животных, спящих в более защищенном месте.
```{r}
pearson.test(dfNew1$SLEEP)
lillie.test(dfNew1$SLEEP)
ad.test(dfNew1$SLEEP)
shapiro.test(dfNew1$SLEEP)
```

Вес тела для животных, спящих в менее защищенном месте.
```{r}
pearson.test(dfNew5$BODY_WEI)
lillie.test(dfNew5$BODY_WEI)
ad.test(dfNew5$BODY_WEI)
shapiro.test(dfNew5$BODY_WEI)
```
Сон для животных, спящих в менее защищенном месте.
```{r}
pearson.test(dfNew5$SLEEP)
lillie.test(dfNew5$SLEEP)
ad.test(dfNew5$SLEEP)
shapiro.test(dfNew5$SLEEP)
```

Нормальность отверглась с уровням значимости 0.05 толко для сная животных, 
спящих в менее защищенном месте. Причем по всем критериям отверглась. 

Итак. Группы у нас независимые и некоторые из них имеют нормальное распределение.

4\. Сравним распределения с помощью t-критериев для независимых выборок. Но
сначала проверим гипотезу о равенстве дисперсий распределений.

Для веса тела можно использовать критерий Фишера, а для сна нельзя, так как для сна 
не выполняется нормальность, поэтому ему доверять не будем, но проведем ради 
академического интереса. Так же используем критерий Левена с модулями.
```{r}
var.test(dfNew1$BODY_WEI, dfNew5$BODY_WEI)
var.test(dfNew1$SLEEP, dfNew5$SLEEP)

t.test(abs(dfNew1$BODY_WEI - mean(dfNew1$BODY_WEI, na.rm = TRUE)), 
       abs(dfNew5$BODY_WEI - mean(dfNew5$BODY_WEI, na.rm = TRUE)))
t.test(abs(dfNew1$SLEEP - mean(dfNew1$SLEEP, na.rm = TRUE)), 
       abs(dfNew5$SLEEP - mean(dfNew5$SLEEP, na.rm = TRUE)))
```

Гипотеза о равных дисперсиях не отверглась для веса, а для сна отверглась с 
уровнем значимости 0.05.

Посмотрим на t-критерии с равными и неравными дисперсиями для независимых выборок.
```{r}
t.test(dfNew1$BODY_WEI, dfNew5$BODY_WEI, var.equal=TRUE, alternative="less")
t.test(dfNew1$SLEEP, dfNew5$SLEEP, var.equal=TRUE, alternative="greate")

t.test(dfNew1$BODY_WEI, dfNew5$BODY_WEI, var.equal=FALSE, alternative="less")
t.test(dfNew1$SLEEP, dfNew5$SLEEP, var.equal=FALSE, alternative="greate")
```

Первый критерий точный, второй используется не по назначению (так как дисперсии разные), 
третий и четвертный ассимптотические. Как и предполагалось отверглись гипотезы в 
пользу того, что мы наблюдали на box-plot-ах выше.

5,6\. Так как в случае сна удалось проверить гипотезу только асимптотическим критерием,
а выборки у нас небольшие, воспользуемся непараметрическим t-критерием. А именно
критерием Вилксона.
```{r, warning=FALSE, message = FALSE}
wilcox.test(dfNew1$BODY_WEI, dfNew5$BODY_WEI, alternative="less", paired=FALSE)
wilcox.test(dfNew1$SLEEP, dfNew5$SLEEP, alternative="greate", paired=FALSE)
```

Мощность у этого критерия меньшая, но гипотезы так же отверглись.

7\. Наконец используем двухвыборочный критерий Колмогорова-Смирнова, который имеет 
меньшую мощность, но у которого более общая альтернативная гипотеза.
```{r, warning=FALSE, message = FALSE}
ks.test(dfNew1$BODY_WEI, dfNew5$BODY_WEI)
ks.test(dfNew1$SLEEP, dfNew5$SLEEP)
```

Гипотезы так же отверглись.

8\. Не актуально для текущих данных.

# Об анализе зависимостей.
## Индивидуальное задание 3.
1\. Посмотрим еще раз на ggpairs plot.

## {.tabset .unlisted .unnumbered}

### No factorization

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), 
          columns = c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

### PRED_IND

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=PRED_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

### EXP_IND

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=EXP_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

### DANG_IND

```{r, message=FALSE, warning=FALSE}
dfNew %>% dplyr::select(-NAME) %>%
  ggpairs(diag=list(continuous = "barDiag"), aes(colour=DANG_IND), legend=1,
          columns=c("BODY_WEI", "BRAIN_WE", "SLOWWAVE", "PARADOX", "SLEEP", "LIFESPAN", "GESTTIME"))
```

## {.unlisted .unnumbered}

Можно заметить 1) положительную корреляцию веса тела, веса мозга, продолжительности
жизни и периода вынашивания потомства; 2) положительную корреляцию фаз 
сна и сна в общем смысле; 3) отрицательную корреляцию всего, что было перечислено
в пункте 1), со всем, что было перечислено в пункте 2).

2\. Посмотрим на корреляцию Пирсона между признаками.
```{r, warning=FALSE, message = FALSE}
dplyr::select(dfNew, -NAME) %>%
mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
cor(method = "pearson", use = "pairwise.complete.obs") %>%
melt() %>%
ggplot(aes(X1, X2)) +
  geom_raster(aes(fill = value)) +
  geom_text(aes(label = round(value, 3))) +
  scale_fill_gradient2(low=colors()[555], mid=colors()[1], high=colors()[26]) + 
  ggtitle("dfNew pearson") +
  theme(axis.text.x = element_text(angle = 50, hjust = 1))
```

Видим подтверждение того, что наблюдали на ggpairs, еще заметны отрицательные 
корреляции индексов и сна. То есть чем в большей опасности находиться животное, 
тем меньше оно спит. Еще заметна сильная корреляция между размерами животного и
незащищенностью места, где оно спит.

3\. Теперь посмотрим на корреляции Спирмана между признаками.
```{r, warning=FALSE, message = FALSE}
dplyr::select(dfNew, -NAME) %>%
mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
cor(method = "spearman", use = "pairwise.complete.obs") %>%
melt() %>%
ggplot(aes(X1, X2)) +
  geom_raster(aes(fill = value)) +
  geom_text(aes(label = round(value, 3))) +
  scale_fill_gradient2(low=colors()[555], mid=colors()[1], high=colors()[26]) + 
  ggtitle("dfNew spearman") +
  theme(axis.text.x = element_text(angle = 50, hjust = 1))
```

Больших изменений нет (так как у нас нет выбросов и распределения близкие к 
нормальным). 

4\. Также посчитаем интересные частные корреляции. (НУЖНО ПОВТОРИТЬ ТЕОРИЮ)
```{r, warning=FALSE, message = FALSE}
library(ppcor)
```

Посмотрим на частную корреляцию веса животного и сна за вычетом идексов опасности.
```{r, warning=FALSE, message = FALSE}
((dplyr::select(dfNew, -NAME, -BRAIN_WE, -LIFESPAN, -GESTTIME, -SLOWWAVE, -PARADOX) %>%
  mutate(PRED_IND = as.numeric(PRED_IND), EXP_IND = as.numeric(EXP_IND), DANG_IND = as.numeric(DANG_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>%
as.data.frame())["SLEEP", "BODY_WEI"]
```

Посмотрим на частые корреляцию степени защищенности животного во время сна  и 
сна за вычетом веса и связанных с ним критериев.
```{r, warning=FALSE, message = FALSE}
((dplyr::select(dfNew, -NAME, -PRED_IND, -DANG_IND, -SLOWWAVE, -PARADOX) %>%
  mutate(EXP_IND = as.numeric(EXP_IND)) %>%
  drop_na() %>%
  pcor(method = "spearman"))$estimate %>% 
as.data.frame())["SLEEP", "EXP_IND"]
```


1. Животные с большим весом спят меньше и в более опасных местах. Второе логично, 
потому что они не могут залеть в дупло, первое контринтуитивно, но гугл подверждает 
этот факт, причина его пока не известна. 
2. Животные, находящиеся в большей опасности 
во время сна, спят меньше, тоже логично.


